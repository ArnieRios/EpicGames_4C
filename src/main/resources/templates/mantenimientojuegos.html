
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Epic Games</title>

	<link rel="website icon" type="png" th:href="@{/img/logosteam.png}">

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<link th:href="@{/css/estilos.css}" rel="stylesheet">

	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">
	
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

	<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

	<!-- Buttons extension -->
	<script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>

	<!-- Dependencias para Excel/PDF -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
</head>

<body>
	<header th:replace="~{componentes/cabecera :: cabecera}"></header>

	<div id="contenedor">
		<div class="layout">
			<div th:insert="~{componentes/menu}"></div>

			<div class="main-wrapper">
				<div class="container-fluid pt-5 px-4">
					<h1 class="text-light text-center">Administrar catálogo de juegos</h1>

					<div th:if="${mensaje}" th:text="${mensaje}" th:class="${cssmensaje}" role="alert" class="mt-3"></div>

					<button class="btn btn-primary mb-4" data-bs-toggle="modal" data-bs-target="#modalRegistrar">
						<i class="bi bi-plus-circle"></i> Agregar juego
					</button>
					
					<a th:href="@{/reporte_juego}" class="btn btn-primary mb-4" target="_blank"> 
					        <i class="bi bi-file-earmark-pdf"></i> Reporte PDF 
					    </a>

					<div class="table-responsive rounded border border-secondary overflow-hidden">
						<table id="tablaJuegos" class="table table-dark table-hover align-middle mb-0">
							<thead>
								<tr>
									<th scope="col" class="ps-3">ID</th>
									<th scope="col">Portada</th>
									<th scope="col">Título</th>
									<th scope="col">Descripción</th>
									<th scope="col">Precio</th>
									<th scope="col">Fecha de registro</th>
									<th scope="col">Proveedor</th>
									<th scope="col">Categoría</th>
									<th scope="col">Estado</th>
									<th class="text-center" scope="col">Acciones</th>
								</tr>
							</thead>

							<tbody>
								<tr th:each="j : ${lstJuegos}">
									<td class="ps-3" th:text="${j.idJuego}">1</td>
									<td>
										<img alt="imagen" th:src="@{|/img/juegos/${j.idJuego}.png|}"
											 style="width: 50px; height: 60px;"
											onerror="this.src='/img/juegos/no-imagen.png'">
									</td>
									<td th:text="${j.titulo}">Título</td>
									<td th:text="${j.descripcion}">Descripción</td>
									<td th:text="${j.precio != null ? 'S/ ' + #numbers.formatDecimal(j.precio, 1, 2) : 'S/ 0.00'}">S/ 0.00</td>
									<td class="text-center" th:text="${j.fechReg}">2025-01-01</td>
								<td th:text="${j.objProvedor != null ? j.objProvedor.nom_prov : ''}"></td>
								<td th:text='${j.objCategoria.nom_categoria}'></td>
								<td th:text='${j.objEstado.nom_estado}'>activo</td>

									<td style="height: 60px;">
										<div class="d-flex justify-content-evenly align-items-center h-100 gap-2 pb-1">
											<a class="btn btn-primary btn-sm"
												th:href="@{/epicgames/juegos/editar/{id}(id=${j.idJuego})}">
												Editar
											</a>

									<form class="m-0" th:if="${j.idEstado != 2}"
												th:action="@{/epicgames/juegos/eliminar/{id}(id=${j.idJuego})}" method="post">
												<button type="submit" class="btn btn-danger btn-sm"
													onclick="return confirm('¿Eliminar juego?')">
													Eliminar
												</button>
											</form>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

		<!-- Modal Registrar -->
		<div class="modal" id="modalRegistrar" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="container rounded text-bg-dark border border-secondary px-5 py-3">
						<h2 class="text-center">Agregar juego</h2>

						<form th:action="@{/epicgames/juegos/registrar}" method="post" class="row g-4"
							th:object="${nuevoJuego}">

							<div class="col-md-12">
								<label class="form-label">Título</label>
								<input type="text" class="form-control" maxlength="150" required th:field="*{titulo}">
							</div>

							<div class="col-md-12">
								<label class="form-label">Descripción</label>
								<textarea class="form-control" maxlength="500" rows="4"
										style="resize: none; overflow-y: auto;" required th:field="*{descripcion}"></textarea>
							</div>

							<div class="col-md-6">
								<label class="form-label">Precio</label>
								<input type="number" step="0.01" min="0" max="99999999.99"
										class="form-control" required th:field="*{precio}">
							</div>

							<div class="col-md-6">
										<label class="form-label">Proveedor</label>
										<select class="form-select" th:field="*{idProvedor}" required>
											<option value="" selected disabled>Seleccione...</option>
											<option th:each="p : ${lstProvedores}"
													th:value="${p.id_provedor}"
													th:text="${p.nom_prov}">
											</option>
										</select>
									</div>

									<div class="col-md-6">
								<label class="form-label">Categoría</label>
								<select class="form-select" th:field="*{idCategoria}" required>
								    <option value="" selected disabled>Seleccione...</option>
								    <option th:each="c : ${lstCategorias.?[idEstado ==1]}"
								            th:value="${c.id_categoria}"
								            th:text="${c.nom_categoria}">
								    </option>
								  </select>
									</div>

							<div class="col-md-12 d-flex justify-content-start gap-3">
								<button type="submit" class="btn btn-primary">Guardar</button>
								<a th:href="@{/epicgames/juegos}" class="btn btn-danger">Cancelar</a>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>

		<footer class="footer">
			<i class="bi bi-tiktok fs-2 m-2"></i>
			<i class="bi bi-facebook fs-2 m-2"></i>
			<i class="bi bi-youtube fs-2 m-2"></i>
			<p>Derechos Reservados. Lima, Perú - 2025</p>
		</footer>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
	<script>
	  $(function () {
	    $('#tablaJuegos').DataTable({
	      dom: 'Bfrtip',
	      buttons: ['copy', 'excel', 'pdf', 'print'],
	      language: { url: 'https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json' }
	    });
	  });
	</script>
</body>
</html>
