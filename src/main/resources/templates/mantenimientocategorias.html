<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Epic Games</title>

	<link rel="website icon" type="png" th:href="@{/img/logosteam.png}">

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<link th:href="@{/css/estilos.css}" rel="stylesheet">

	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">

	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

	<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

	<!-- Buttons extension -->
	<script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>

	<!-- Dependencias para Excel/PDF -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
</head>

<body>
	<header th:replace="~{componentes/cabecera :: cabecera}"></header>

	<div id="contenedor">
		<div class="layout">
			<div th:insert="~{componentes/menu}"></div>

			<div class="main-wrapper">
				<div class="container-fluid pt-5 px-4">
					<h1 class="text-light text-center">Administrar categorías</h1>

					<div th:if="${mensaje}" th:text="${mensaje}" th:class="${cssmensaje}" role="alert" class="mt-3">
					</div>

					<button class="btn btn-primary mb-4" data-bs-toggle="modal" data-bs-target="#modalRegistrar">
						<i class="bi bi-plus-circle"></i> Agregar Categoría
					</button>
					<a href="/reportes" class="btn btn-primary mb-4" target="_blank"> Reporte PDF </a>
					
					
					<div class="table-responsive rounded border border-secondary overflow-hidden">
						<table id="tablaCategorias" class="table table-dark table-hover align-middle mb-0">
							<thead>
								<tr>
									<th scope="col" class="ps-3">ID</th>
									<th scope="col" class="ps-3">Portada</th>
									<th scope="col">Nombre</th>
									<th scope="col">Descripción</th>
									<th scope="col">Estado</th>
									<th class="text-center" scope="col">Acciones</th>
								</tr>
							</thead>

							<tbody>
								<tr th:each="c : ${lstCategorias}">


									<td th:text="${c.id_categoria}">Id</td>
									<td>
										<img alt="imagen" th:src="@{|/img/categorias/${c.id_categoria}.png|}"
											style="width: 50px; height: 60px;"
											onerror="this.src='/img/categorias/no-imagen.png'">
									</td>
									<td th:text="${c.nom_categoria}">Título</td>
									<td th:text="${c.descripcion}">Descripción</td>
									<td th:text="${c.objEstado.nom_estado}">Estado</td>

									<td style="height: 60px;">
										<div class="d-flex justify-content-evenly align-items-center h-100 gap-2 pb-1">
											<a class="btn btn-primary btn-sm"
												th:href="@{/epicgames/categorias/editar/{id}(id=${c.id_categoria})}">
												Editar
											</a>
											
											<form class="m-0" th:if="${c.idEstado != 2}"
												th:action="@{/epicgames/categorias/eliminar/{id}(id=${c.id_categoria})}"
												method="post">
												<button type="submit" class="btn btn-danger btn-sm"
													onclick="return confirm('¿Eliminar Categoria?')">
													Eliminar
												</button>
											</form>
										</div>
									</td>

								</tr>

							</tbody>
						</table>
					</div>



					<!-- Modal Registrar -->

					<div class="modal" id="modalRegistrar" tabindex="-1" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="container rounded text-bg-dark border border-secondary px-5 py-3">
									<h2 class="text-center">Agregar Categoria</h2>

									<form th:action="@{/epicgames/categorias/registrar}" method="post" class="row g-4"
										th:object="${nuevaCategoria}">

										<div class="col-md-12">
											<label class="form-label">Título</label>
											<input type="text" class="form-control" maxlength="100" required
												th:field="*{nom_categoria}">
										</div>

										<div class="col-md-12">
											<label class="form-label">Descipción</label>
											<input type="text" class="form-control" maxlength="100" required
												th:field="*{descripcion}">
										</div>


										<div class="col-md-12 d-flex justify-content-start gap-3">
											<button type="submit" class="btn btn-primary">Guardar</button>
											<a th:href="@{/epicgames/categorias}" class="btn btn-danger">Cancelar</a>
											
										</div>


									</form>
								</div>
							</div>
						</div>
					</div>


				</div>

				<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
				<script>
					$(function () {
						$('#tablaCategorias').DataTable({
							dom: 'Bfrtip',
							buttons: ['copy', 'excel', 'pdf', 'print'],
							language: {url: 'https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json'}
						});
					});
				</script>
</body>

</html>