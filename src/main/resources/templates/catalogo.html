<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Epic Games</title>

<link rel="website icon" type="png" href="img/logosteam.png">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link th:href="@{/css/estilos.css}" rel="stylesheet">

<style>
  :root{
    --bs-dark-rgb: 11, 29, 58;
  }
  .game-img{
    height: 160px;
    object-fit: cover;
  }
</style>
</head>

<body>
	<div id="contenedor">
  <jsp:include page="./componentes/cabecera.jsp"/>

  <div class="layout">
    <jsp:include page="./componentes/menu.jsp"/>

    <main class="content py-3">


      <fmt:setLocale value="es-PE" />
      
      <c:set var="catSel" value="${param.cat}" />
      <c:if test="${catSel == null}">
        <c:set var="catSel" value="0" />
      </c:if>
      <fmt:parseNumber var="catSelNum" value="${catSel}" integerOnly="true" />

      <div class="d-flex align-items-center justify-content-between mb-3">
        <h4 class="m-0 text-light">Videojuegos</h4>
        <c:if test="${catSelNum != 0}">
          <span class="badge text-bg-info">Filtrado</span>
        </c:if>
      </div>

      <!-- ===== FILTRO ===== -->
      <div class="card bg-dark text-light border border-light border-opacity-10 shadow-sm mb-4">
        <div class="card-body">
          <form action="catalogo" method="get" class="row g-2 align-items-end">
            <div class="col-12 col-md-6">
              <label class="form-label">Filtrar por categoría</label>
              <select name="cat" class="form-select bg-dark text-light border border-light border-opacity-25">
                <option value="0" <c:if test="${catSelNum == 0}">selected</c:if>>Todas</option>

          
                <c:forEach var="c" items="${lstCategoria}">
                  <option value="${c.id_categoria}" <c:if test="${catSelNum == c.id_categoria}">selected</c:if>>
                    ${c.nom_categoria}
                  </option>
                </c:forEach>
              </select>
            </div>

            <div class="col-12 col-md-3 d-grid">
              <button class="btn btn-info">
                <i class="bi bi-funnel"></i> Aplicar
              </button>
            </div>

            <div class="col-12 col-md-3 d-grid">
              <a class="btn btn-outline-light" href="catalogo">
                <i class="bi bi-arrow-counterclockwise"></i> Limpiar
              </a>
            </div>
          </form>
        </div>
      </div>


      <c:set var="categoriaSeleccionada" value="" />
      <c:if test="${catSelNum != 0}">
        <c:forEach items="${lstCategoria}" var="c">
          <c:if test="${catSelNum == c.id_categoria}">
            <c:set var="categoriaSeleccionada" value="${c.nom_categoria}" />
          </c:if>
        </c:forEach>
      </c:if>

      <c:set var="hayResultados" value="false" />

     
      <div class="row row-cols-1 row-cols-md-3 g-4">
        <c:forEach var="j" items="${lstJuegos}">
          <c:if test="${catSelNum == 0 || j.categoria == categoriaSeleccionada}">
            <c:set var="hayResultados" value="true" />

            <div class="col">
              <div class="card bg-dark text-light border border-light border-opacity-10 shadow-sm h-100">

                <img src="img/juegos/${j.idJuego}.png"
                     class="card-img-top game-img border-bottom border-light border-opacity-10"
                     alt="imagen del juego"
                     onerror="this.src='img/juegos/no-imagen.png'">

                <div class="card-body">
                  <h5 class="card-title text-truncate" title="${j.titulo}">
                    ${j.titulo}
                  </h5>

                  <p class="card-text small text-light text-opacity-75"
                     style="display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden;">
                    ${j.descripcion}
                  </p>

                  <div class="small">
                    <div><b>Precio:</b> <fmt:formatNumber value="${j.precio}" type="currency"/></div>
                    <div><b>Categoría:</b> ${j.categoria}</div>
                    
                    
                    <div><b>Estado:</b> ${j.estado}</div>
                     <c:choose>
			    	<c:when test="${j.estado == 'activo'}">
			      Disponible
			    </c:when>
			    <c:otherwise>
			      No disponible
			    </c:otherwise>
			  </c:choose>
			                    
                    
                  </div>
                </div>

               
                <div class="card-footer bg-transparent border-0 text-end">
                  <c:choose>
                    <c:when test="${j.estado == 'activo'}">
                      <a class="btn btn-outline-info btn-sm" href="seleccionar?q=${j.idJuego}">
                        <i class="bi bi-cart-plus"></i> Añadir
                      </a>
                    </c:when>
                    <c:otherwise>
                      <button class="btn btn-outline-secondary btn-sm" disabled>
                        <i class="bi bi-lock"></i> No disponible
                      </button>
                    </c:otherwise>
                  </c:choose>
                </div>

              </div>
            </div>

          </c:if>
        </c:forEach>
      </div>

      <!-- Mensaje si no hay resultados -->
      <c:if test="${hayResultados == false}">
        <div class="alert alert-warning mt-3">
          No se encontraron juegos para esta categoría.
        </div>
      </c:if>

    </main>
</div>
    <footer class="footer">
      <i class="bi bi-tiktok fs-2 m-2"></i>
      <i class="bi bi-facebook fs-2 m-2"></i>
      <i class="bi bi-youtube fs-2 m-2"></i>
      <p>Derechos Reservados. Lima, Perú - 2025</p>
    </footer>

  </div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

